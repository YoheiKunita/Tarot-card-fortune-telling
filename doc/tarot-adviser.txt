モジュールの内容は、引いたタロットカードとユーザーが入力した任意の占いしたい事柄ととともにchatgptへ送り、カードごとの占いの見立てを取得するものである。

構成（ポート&アダプタ）

Domain（純ロジック）

Card, Spread, Reading エンティティ

位置関係・逆位置などの解釈ルールの“前処理”のみ（LLM前の文脈化）

PromptBuilder（入力→プロンプト）

ユーザー質問と引いたカードを言語非依存の中間構造に整形

1つの責務：LLMに渡すテンプレートを生成

LLMClient（外部サービス）

OpenAI等のクライアント。JSONスキーマ出力を強制

リトライ、タイムアウト、レート制御、観測ログ

Parser/Validator（出力検証）

返却JSONをスキーマ検証（zod等）

不正時はフォールバック（再試行 or 簡易サマリ）

UseCase/Application（ユースケース層）

GenerateReadingUseCase

キャッシュ（同一質問＋同一カードの再利用）

監査ログ（入力ハッシュ、推論ID、トークン量）