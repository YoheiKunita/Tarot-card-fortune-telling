# 作業メモ（2025-10-04）

## 概要
- スタートメニューの不反応を調査・修正。設定UIの重複を排除し、イベント委譲で安定化。
- 一時的に「暗転＋戻る」仕様を実装したが、要望により元に戻した。
- 未解決課題の抽出用スクリプトを追加（`scripts/extract_unresolved.ps1`）。

## 作業内容
- ボタン不反応の直接原因を修正
  - Post-build 調整ブロック内の未定義変数 `b3`/`b1` 参照を削除（ReferenceError防止）。
  - `#startMenu` に委譲ハンドラを追加・拡充し、動的再構築後でも `btnMore`/`btnSettings`/`btnSpreadStart`/`btnExit(Yes/No)` などが確実に反応。
- 設定UIの一本化
  - 旧オーバーレイ `#settings` 生成コードを削除し、`panelSettings`（または `panelSetting`）のパネル方式に統一。
  - ショートカット `Ctrl+,` で設定パネルを開く処理を再実装（両ID対応）。
- スタートメニュー表示仕様の試行とリバート
  - 「暗転オーバーレイ＋戻る」ボタン（`btnCloseMenu`）を一時導入→リクエストにより撤回。
  - `#btnMenu` クリック時の挙動を「reset→表示」に復旧。
- クリック阻害の除去
  - スタートメニュー表示時に `#adviserDim`/`#adviserOut`/`#adviceOverlay` を明示的に無効化。
- その他
  - `index.html` のスタートメニューへ「終了」ボタン常設。
  - 未解決課題抽出スクリプトを `scripts/extract_unresolved.ps1` として追加。

## 変更ファイル
- `src/index.html`
- `src/renderer.js`
- `src/styles.css`（参照のみ）
- `scripts/extract_unresolved.ps1`（新規）

## 残課題
- 設定パネルIDの統一：`panelSettings` と `panelSetting` の二重対応を一本化。
- スタートメニュー再構成ロジックと既存動的生成の一元化（ガード見直し）。
- アドバイスキャッシュの保持期間と「キャッシュ削除」導線の設計。
- 一部環境での日本語文字化けの原因特定と回避（フォント/エンコーディング）。
- UIの暗転オーバーレイ仕様（戻る含む）は保留。

## 動作確認
- スプラッシュ後、`詳細な展開を選ぶ`/`設定`/`終了` が反応する。
- 設定パネルで `保存して戻る`/`戻る` が機能し、速度・API設定が保存/反映される。
- どの画面でも `#btnMenu` でスタートメニューが表示され、他オーバーレイがクリックを阻害しない。

## 次のTODO
- 設定パネルIDの統一と参照整理。
- メニュー構築の一元化（初期DOMと動的置換の重複排除）。
- 文字化け再現環境での実機検証と対策案の作成。
- キャッシュ方針（保持期間・手動削除UI）を決定・実装。

