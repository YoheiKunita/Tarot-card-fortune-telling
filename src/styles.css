:root{
  --bg: #0b0e1a;
  --fg: #eaeaf2;
  --acc: #c8a96b;
  --muted: #9aa3b2;
  /* Animation timing variables (defaults reflect ~70% speed) */
  --flip-duration: 420ms;   /* card flip */
  --fly-duration: 252ms;    /* flying card travel */
  --info-duration: 160ms;   /* caption fade */
  --dim-duration: 175ms;    /* dim fade */
  /* Card sizing */
  /* 20% smaller base size */
  --card-w: 114px;  /* 143 * 0.8 */
  --card-h: 187px;  /* 234 * 0.8 */
  /* Keep enlarged hover size approximately the same: 1.54 / 0.8 â‰ˆ 1.925 */
  --card-hover-scale: 1.925;
}

*{ box-sizing: border-box; }
html, body { height: 100%; }
html{ background: var(--bg); }
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
  /* Avoid background-attachment: fixed seam; render as normal background */
  background: var(--bg) url('../img/background.png') center/cover no-repeat;
  color: var(--fg);
}
/* Splash overlay */
.splash{ position: fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.55); z-index: 1200; cursor: pointer; }
.splash-inner{ display:flex; flex-direction:column; align-items:center; gap:14px; }
.splash-title{ max-width: min(80vw, 720px); width: 80vw; height: auto; filter: drop-shadow(0 12px 40px rgba(0,0,0,0.6)); }
.splash-hint{ color: var(--fg); opacity: 0.9; font-size: 18px; letter-spacing: 0.06em; }
/* Cover potential 1px hairline under native menu bar on Windows */
body::before{
  content: "";
  position: fixed; left:0; right:0; top:0; height:1px;
  background: var(--bg);
  pointer-events: none; z-index: 2;
}
header h1{ display:none; }
/* Hide in-app header to avoid a dark band under native title bar */
header{
  display: none;
}
h1{ font-size: 20px; margin:0; letter-spacing: 0.03em; }
button{
  background: var(--acc); color:#1b1b1b; border:none; padding:10px 16px; border-radius:8px;
  font-weight: 600; cursor:pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
button:disabled{ opacity:0.6; cursor:not-allowed; }

main{ padding: 24px; }
.stage{ position: relative; }
#stage{ position: relative; min-height: 780px; padding-bottom: 160px; }

.dim{ position:absolute; inset:0; background: rgba(0,0,0,0.35); opacity:0; transition: opacity var(--dim-duration) ease; pointer-events: none; }
/* Do not visually dim the background on reveal */
.dim.active{ opacity: 0; }

.deck{ position: absolute; left: 24px; bottom: 24px; transform: none; width: calc(var(--card-w) + 50px); height: calc(var(--card-h) + 50px); }
.deck .pilecard{
  position:absolute; width: var(--card-w); height: var(--card-h); border-radius: 10px; border:1px solid rgba(255,255,255,0.12);
  background: #1b2134 url('../img/back.png') center/cover no-repeat;
  box-shadow: 0 6px 14px rgba(0,0,0,0.5);
}
.oppile{
  position:absolute; right: 24px; bottom: 24px;
  width: calc(var(--card-w) + 50px); height: calc(var(--card-h) + 50px);
}
.oppile .pilecard{
  position:absolute; width: var(--card-w); height: var(--card-h); border-radius: 10px; border:1px solid rgba(255,255,255,0.12);
  background: #1b2134 url('../img/back.png') center/cover no-repeat;
  box-shadow: 0 6px 14px rgba(0,0,0,0.5);
}
.oppile .pilecard:nth-child(1){ transform: translate(10px, 10px) rotate(2deg); }
.oppile .pilecard:nth-child(2){ transform: translate(16px, 14px) rotate(-1deg); }
.oppile .pilecard:nth-child(3){ transform: translate(22px, 18px) rotate(1deg); }
.oppile .pilecard:nth-child(4){ transform: translate(28px, 22px) rotate(-2deg); }
.oppile .pilecard:nth-child(5){ transform: translate(34px, 26px) rotate(1deg); }
.oppile .pilecard:nth-child(6){ transform: translate(40px, 30px) rotate(-1deg); }
.deck .pilecard:nth-child(1){ transform: translate(10px, 10px) rotate(-2deg); }
.deck .pilecard:nth-child(2){ transform: translate(16px, 14px) rotate(1deg); }
.deck .pilecard:nth-child(3){ transform: translate(22px, 18px) rotate(-1deg); }
.deck .pilecard:nth-child(4){ transform: translate(28px, 22px) rotate(2deg); }
.deck .pilecard:nth-child(5){ transform: translate(34px, 26px) rotate(-1deg); }
.board:not(.absolute-board){ display:grid; grid-template-columns: repeat(3, minmax(220px, 1fr)); gap: 28px; max-width: 1100px; margin: 0 auto; padding-top: 40px; }
.slot{ position: relative; display:flex; flex-direction:column; align-items:center; gap: 10px; }

.card{ width: var(--card-w); height: var(--card-h); perspective: 900px; position:relative; transition: transform var(--flip-duration) ease; }
/* Compose base rotation with flip using a CSS variable */
.card .inner{ width:100%; height:100%; position:relative; transform-style:preserve-3d; transition: transform var(--flip-duration) ease; transform: var(--base-rot, rotate(0deg)); }
.card.revealed .inner{ transform: var(--base-rot, rotate(0deg)) rotateY(180deg); }
.card.hidden{ visibility: hidden; }
.card .face{
  position:absolute; inset:0; backface-visibility: hidden; border-radius: 12px; overflow:hidden; border:1px solid rgba(255,255,255,0.12);
}
.card .face.back{ display:flex; align-items:center; justify-content:center; background:#111; }
.card .face.back img{ width:100%; height:100%; object-fit:cover; }
.card .face.front{ transform: rotateY(180deg); background: #222; display:flex; align-items:center; justify-content:center; }
.card .face.front img{ width: 100%; height: 100%; object-fit: cover; image-rendering: auto; }

.card.reversed .face.front img{ transform: rotate(180deg); }

/* Hover enlarge and info-on-hover for revealed cards */
.slot .card.revealed:hover{ transform: scale(var(--card-hover-scale)); z-index: 5; }
.slot .card.revealed:hover + .info{ opacity:1; transform: translateY(0); }

.info{ position:absolute; left:50%; right:auto; bottom:8%; color:#e8ecf7; line-height:1.5; font-size: 14px; white-space: pre-wrap; padding:10px 12px; background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; box-shadow: 0 6px 14px rgba(0,0,0,0.35); opacity:0; transform: translate(-50%, 6px); transition: opacity var(--info-duration) ease, transform var(--info-duration) ease; pointer-events:none; text-shadow: 0 1px 1px rgba(0,0,0,0.5); z-index: 10; width: max-content; max-width: min(18em, 90vw); }
.info.show{ opacity:1; transform: translate(-50%, 0); }
/* Force info hidden unless hovering revealed card; show when enlarged (hover) */
.slot .card.revealed + .info{ opacity:0 !important; transform: translate(-50%, 6px) !important; }
.slot .card.revealed:hover + .info{ opacity:1 !important; transform: translate(-50%, 0) !important; }
.info .name{ font-weight:700; color: var(--acc); }
.info .ori{ color:#c0c5d0; font-size:12px; margin-left: 6px; }

@media (max-width: 900px){
  .board:not(.absolute-board){ grid-template-columns: 1fr; justify-items:center; }
}

/* Flying card animation element */
.flying-card{
  position: fixed; left: 0; top: 0; width: var(--card-w); height: var(--card-h);
  border-radius: 12px; border:1px solid rgba(255,255,255,0.12);
  background: #1b2134 url('../img/back.png') center/cover no-repeat;
  box-shadow: 0 10px 24px rgba(0,0,0,0.6);
  transform: translate(0,0);
  transition: transform var(--fly-duration) cubic-bezier(.22,.61,.36,1);
  z-index: 9999;
}

/* Removed slot label styling (labels no longer used) */

/* Start menu overlay */
.start-menu{ position: fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.55); z-index: 1000; }
.start-menu .panel{ background: rgba(20,24,40,0.95); border:1px solid rgba(255,255,255,0.14); border-radius: 14px; padding: 24px 28px; min-width: 360px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
.start-menu h2{ margin:0 0 14px; font-size: 20px; color: var(--fg); }
.start-menu .options{ display:flex; flex-direction:column; gap:12px; }
.start-menu button.primary{ background: var(--acc); color:#1b1b1b; }

/* Bottom-right actions */
.actions{ position: fixed; right: 20px; bottom: 20px; display:none; gap:10px; z-index: 900; }
.actions.show{ display:flex; }
.actions button.primary{ background: var(--acc); color:#1b1b1b; }

/* Adviser output panel */
.adviser-out{
  position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%) scale(0.9); z-index: 1200;
  max-width: min(80vw, 720px); padding: 16px 18px; border-radius: 14px;
  background: rgba(20,24,40,0.98); color: var(--fg);
  border:1px solid rgba(255,255,255,0.14);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  line-height: 1.7; font-size: 15px; white-space: pre-wrap;
  opacity: 0; transition: transform 160ms ease, opacity 160ms ease;
}
.adviser-out.show{ opacity: 1; transform: translate(-50%, -50%) scale(1); }

.adviser-out .controls{ display:flex; justify-content:flex-end; margin-top: 12px; }
.adviser-out .controls .btn-back{ background: var(--acc); color:#1b1b1b; border:none; padding:10px 16px; border-radius:8px; font-weight:600; cursor:pointer; }

.adviser-dim{ position: fixed; inset: 0; background: rgba(0,0,0,0.7); opacity:0; transition: opacity var(--dim-duration) ease; pointer-events:none; z-index: 1100; }
.adviser-dim.on{ opacity:1; pointer-events:auto; }

/* Advice modal overlay */
.advice-overlay{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.7); z-index: 1100; }
.advice-modal{ background: rgba(20,24,40,0.98); color: var(--fg); border:1px solid rgba(255,255,255,0.14); border-radius: 14px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); padding: 18px 20px 56px; width: min(90vw, 720px); max-height: 80vh; overflow:auto; position: relative; }
.advice-content{ white-space: pre-wrap; line-height: 1.8; font-size: 15px; }
.advice-close{ position:absolute; right: 16px; bottom: 14px; background: var(--acc); color:#1b1b1b; border:none; padding:10px 16px; border-radius:8px; font-weight: 600; cursor:pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }

/* Dynamic absolute board for flexible spreads */
.absolute-board{ position: relative; min-height: 640px; max-width: 1100px; margin: 0 auto; padding-top: 20px; }
.absolute-board .slot{ position: absolute; }

/* Spread selection grid in start menu */
.spread-grid{ display:grid; grid-template-columns: repeat(2, minmax(160px,1fr)); gap:10px; }
.start-menu .row{ margin-top: 8px; display:flex; justify-content:flex-end; }
